#include <stdio.h>
#include <stdlib.h>
#include <winsock2.h>
#include <windows.h>
#include <shlobj.h>

#pragma comment(lib, "ws2_32.lib")

void malicious_behavior() {
    printf("[*] Starting Fake Malware behavior...\n");

    // 1. File System Activity
    char desktopPath[MAX_PATH];
    if (SUCCEEDED(SHGetFolderPath(NULL, CSIDL_DESKTOP, NULL, 0, desktopPath))) {
        char filePath[MAX_PATH];
        snprintf(filePath, MAX_PATH, "%s\\hacked.txt", desktopPath);
        
        FILE *f = fopen(filePath, "w");
        if (f) {
            fprintf(f, "You have been infected! (Just kidding)\n");
            fclose(f);
            printf("[+] Created file: %s\n", filePath);
        } else {
            printf("[-] Failed to create file: %s\n", filePath);
        }
    }

    // 2. Network Activity
    WSADATA wsa;
    SOCKET s;
    struct sockaddr_in server;
    char *message = "GET / HTTP/1.1\r\nHost: example.com\r\n\r\n";

    if (WSAStartup(MAKEWORD(2, 2), &wsa) == 0) {
        if ((s = socket(AF_INET, SOCK_STREAM, 0)) != INVALID_SOCKET) {
            server.sin_addr.s_addr = inet_addr("93.184.216.34");
            server.sin_family = AF_INET;
            server.sin_port = htons(80);

            if (connect(s, (struct sockaddr *)&server, sizeof(server)) >= 0) {
                printf("[+] Connected to example.com:80\n");
                send(s, message, strlen(message), 0);
            }
            closesocket(s);
        }
        WSACleanup();
    }

    // 3. Process Spawning
    STARTUPINFO si;
    PROCESS_INFORMATION pi;
    ZeroMemory(&si, sizeof(si));
    si.cb = sizeof(si);
    ZeroMemory(&pi, sizeof(pi));

    printf("[+] Launching Notepad...\n");
    if (CreateProcess(NULL, "notepad.exe", NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi)) {
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
    }

    Sleep(20000); 
}

int main() {
    malicious_behavior();
    return 0;
}
